# GPIO

## `split`

* Передавать `&mut rcc.bus` (F1, F3, L4)
* Передавать `&mut rcc` (F0, L0, G0, G4)
  * Предпочтительнее, так как шины в разных МК разные
* Не передавать ничего (F4)
  * Ещё лучше, но требует критических секций или unsafe

## Настройка пинов

* передавать регистры GPIO явно
  * [-] многословно
  * [-] регистры в разных семействах разные
  * [-] надо угадывать с xxxh/xxxl
* передавать критическую секцию
  * [+] нет оверхеда
  * [-] дико неудобно: нужно вытаскивать все пины из критической секции наружу
* сделать критическую секцию внутри
  * [-] оверхед на interrupt::free
* аналог RefCell, одновременное обращение порождает панику
  * [+] прозрачность
  * [-] оверхед по памяти
  * [-] оверхед на панику
* сделать функцию unsafe
  * [+] нет оверхеда, позволяет обойтись без критической секции
  * [-] unsafe — хал должен отдавать safe абстракции

## Настройка альтернативных функций

* передавать регистры GPIO/AFIO явно
  * [-] многословно
  * [-] регистры в разных семействах разные
  * [-] надо угадывать с xxxh/xxxl
* передавать критическую секцию
  * [+] нет оверхеда
  * [-] дико неудобно: нужно вытаскивать все пины из критической секции наружу
* сделать критическую секцию внутри
  * [-] оверхед на interrupt::free
* `pub(crate) fn set_alt_mode`
  * [+] избавляет пользователей от необходимости задавать AF явно
  * [-] небезопасно, может привести к состоянию гонки
* `pub(crate) fn unsafe set_alt_mode`
  * [+] избавляет пользователей от необходимости задавать AF явно

## Стёртые типы

## Именование методов

## Дополнительные фичи

* `with_*` методы — временное использование пина в другом режиме (L0)
